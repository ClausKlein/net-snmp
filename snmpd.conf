# date: 2013-01-25 (ck)

#FIXME oldEngineID 0x80001f88017f000001
#mac engineIDType 3
# use ip addr
## engineIDType 1
# use eth0 interface
## engineIDNic 2

## agentaddress udp6:[::1]:161,udp::161
agentaddress udp6:161,udp:161
# --agentaddress=udp6:161,udp:161

########################
# enable agentx via tcp:
########################
master agentx
# agentxsocket             AgentX bind address
agentxsocket tcp:127.0.0.1:705
# agentXSocket [<transport-specifier>:]<transport-address>[,...]

agentXTimeout 5s
# agentxTimeout            AgentX Timeout (seconds)
# defines the timeout period (NUM seconds) for an AgentX request.  Default is 1 second.
agentXRetries 0
# agentxRetries            AgentX Retries
# defines the number of retries for an AgentX request.  Default is 5 retries.

#===========================================================================================
# create a view with access to all MIBs; Needed to be able to configure context restrictions
# view VNAME TYPE OID [MASK]
#===========================================================================================
view iso included .iso
view system included .system

########################
# create snmp v3 users
########################
## createUser netadmin MD5 "mypassword" DES "mypassword"
## rwuser netadmin authPriv -V iso ""

#FIXME createUser trapuser MD5 "--none--" DES "--none--"
#FIXME rouser trapuser noAuthNoPriv -V iso *

createUser unsec MD5 "--none--" DES "--none--"
rwuser unsec noAuthNoPriv -V iso *
# If no context field is given, then we default to matching all contexts (for
# compatability with previous releases).  But if a field context is specified
# (not ending with '*') then this should be taken as an exact match.
# Specifying a context field of "" will match the default context (and *only*
# the default context).

########################
# create snmp v2c communities
# r{o,w}community[6] COMMUNITY [SOURCE [OID | -V VIEW [CONTEXT]]]
########################
### rocommunity public localhost -V system *
### rocommunity private localhost -V iso

# authcommunity     TYPES   COMMUNITY   [SOURCE [OID | -V VIEW [CONTEXT]]]
#   is an alternative to the rocommunity/rwcommunity directives.  TYPES will
#   usually  be  read  or read,write  respectively.  The view specification can
#   either be an OID subtree (as before), or a named view (defined using the view
#   directive) for greater flexibility.  If this is  omitted, then  access will be
#   allowed to the full OID tree.  If CONTEXT is specified, access is configured
#   within this SNMPv3 context.  Otherwise the default context ("") is used.
# needs patched vacm_conf.c: vacm_parse_authtokens()!
# authcommunity authtype1,authtype2 community [default|hostname|network/bits [oid|-V view [CONTEXT]]]
authcommunity read        public   default -V system
authcommunity read,write  private  default -V iso  # all at default context
authcommunity read,write  wfa1     default -V iso wfa1
authcommunity read,write  wfa2     default -V iso wfa2
authcommunity read,write  wfa3     default -V iso wfa3
authcommunity read,write snmptrapd default -V iso snmptrapd

########################
# Notification Handling:
########################
#XXX authtrapenable 1
##default  doNotRetainNotificationLogs no

### trapsess -v 2c -c private  udp6:traptarget:162
## trapsess -v 2c -c public  udp:localhost:162

# This is the appropriate directive for defining SNMPv3 trap receivers. See
# http://www.net-snmp.org/tutorial/tutorial-5/commands/snmptrap-v3.html for
# more information about SNMPv3 notification behaviour.
### trapsess -v 3 -e 0x80001f88017f000001 -D usm -u trapadmin -a MD5 -A mypassword -x DES -X mypassword -l authPriv udp6:traptarget:162
#FIXME: trapsess -v 3 -u trapuser -l noAuthNoPriv udp:10.11.12.13:162

snmpNotifyTable  "NMS" "NMS" 1 3 1
targetAddr NMS .1.3.6.1.6.1.1 0x7f00000100a2 1500 3 "NMS" NMS 3 1
targetParams NMS 3 3 trapuser 1 3 1

#XXX default trapsession config: send v3 traps to localhost with fix engineID
trapsess -v 3 -e 0x80001f88017f000001 -u trapuser -l noAuthNoPriv udp:127.0.0.1:162

########################
## usage: ip.addr == 172.23.33.25 && udp.port == 4700
## snmpwalk -r 0 -v 3 -l noAuthNoPriv -u unsec -n snmptrapd wd002072.rsint.net:4700 sysuptime
########################
# sudo agent/snmpd -f -Le -C -c ./snmpd.conf -Dsnmpv3,trap,notif,send,usm
# sudo agent/snmpd -f -Le -C -c ./snmpd.conf '--authuser=read,write unsecureUser noauth' --createUser=unsecureUser --master=agentx --agentXSocket=tcp:localhost:705 -Dagentx,snmp_agent,register,trap,notify localhost:4700
